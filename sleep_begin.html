<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.css" rel="stylesheet" />
		<script src="js/mui.min.js"></script>
		<link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/sleep/beginsleep.css"/>
		<link rel="stylesheet" type="text/css" href="css/sleep/stylebegin.css">
		<link rel="stylesheet" type="text/css" href="css/sleep/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="css/sleep/default.css">
		<link rel="stylesheet" type="text/css" href="css/common.css"/>
		<link href="https://fonts.googleapis.com/css?family=Nixie+One" rel="stylesheet" type="text/css">
		<style type="text/css">
			body{background: #F0F0F0;}
		</style>
				<script type="text/javascript">  
			 if(window.localStorage){  
			 var un = localStorage.getItem("username");  
			 var pas = localStorage.getItem("password");  
			 //alert(un+pas);  
			 }else{alert("浏览不支持localStorage")}  
		</script>
	<script type="text/javascript">
			if(window.localStorage){
					 	var un = localStorage.getItem("username");
						var pas = localStorage.getItem("password");
						//alert(un+pas);
						var defaT = localStorage.getItem("defatime");
						var naoxing = localStorage.getItem("nx");
						var naozhong = localStorage.getItem("nz");
					    var bzy = localStorage.getItem("bzy");
						
						
					}else{alert("浏览不支持localStorage")};
	</script>
	<script src="svg/iconfont.js" type="text/javascript" charset="utf-8"></script>
		<style>
			.icon {
			width: 35px;
			height: 35px;
			vertical-align: -0.15em;
			fill: currentColor;
			overflow: hidden;
		}
	</style>
	</head>

	<body>
		<script src="js/mui.js"></script>
		<script type="text/javascript">
			mui.init()
		</script>
		<!-- <button type="button" class="noiseBtn" onclick="openNoise()"><h3>白噪音</h3></button> -->
		<div  class="noiseBtn" onclick="openNoise()"> 
			<svg class="icon" aria-hidden="true">
				<use xlink:href="#icon-bzy"></use>
			</svg>
			<h3 class="word1" style="line-height: 0px;">白噪音</h3>
		</div> 
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" ></a>
			<h1 class="mui-title">开始睡眠</h1>
			<audio src='http://hao.haolingsheng.com/ring/000/995/3e3966097062ba7638a0aba60d898b48.mp3' preload='auto' id='music1'>	
			</audio>
			
			<audio src='http://hao.haolingsheng.com/ring/000/995/f1b408f77bc8d27a6f5665c1be02df5d.mp3' preload='auto' id='music2'>	
			</audio>
			
			<audio src='http://hao.haolingsheng.com/ring/000/995/899004608491de178a7234ab5538feb9.mp3' preload='auto' id='music3'>	
			</audio>
			
			<audio src='http://hao.haolingsheng.com/ring/000/995/3428620bff41797ca0fde66a1a47b0fc.mp3' preload='auto' id='music4'>	
			</audio>
			<audio src='http://hao.haolingsheng.com/ring/000/995/bde5a74a2520d82b8ed6d51c227f383c.mp3' preload='auto' id='music5'>	
			</audio>
			
			
			<audio src='http://link.hhtjim.com/163/483507575.mp3' preload='auto' id='musicb1'>	
			</audio>
			
			<audio src='http://link.hhtjim.com/163/505248904.mp3' preload='auto' id='musicb2'>	
			</audio>
			
			<audio src='http://link.hhtjim.com/163/517354280.mp3' preload='auto' id='musicb3'>	
			</audio>
			<audio src='http://link.hhtjim.com/163/526367571.mp3' preload='auto' id='musicb4'>	
			</audio>
			<audio src='http://link.hhtjim.com/163/483877904.mp3' preload='auto' id='musicb5'>	
			</audio>
			
			<audio src='http://link.hhtjim.com/163/485861685.mp3' preload='auto' id='musicb6'>	
			</audio>
			<audio src='http://link.hhtjim.com/163/483780870.mp3' preload='auto' id='musicb7'>	
			</audio>
		</header>
		
		<article class="htmleaf-container">
			<div class="container-fluid">
				<div class="col-xs-12 fill">
					<span id="runner"></span><br><br>
					<div class="col-sm-10 col-sm-offset-2">
						<div class="col-xs-4 col-sm-3 centered" ><button id="stopBtn" onclick="recordtime2();toStop()"></button></div>
						<div class="col-xs-4 col-sm-3 centered"><button id="startBtn" onclick="recordtime1();start_score();toPlay()"></button></div>
						<div class="col-xs-4 col-sm-3 centered"><button id="resetBtn" onclick="toStop()"></button></div>
					</div>
				</div>
			</div>
		</article>
			
		<script src="js/jquery-2.1.1.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.runner-min.js"></script>
		<script src="js/app.js"></script>
		
		<button type="button" class="returnreport" onclick="openReport()">返回报告</button>
		
		<script>
			
			var arr = defaT .split(":");
			var sethour = arr[0];
			var setmin = arr[1];
			if(setmin<naoxing*5){
				sethour = sethour-1;
				setmin = 60 - (5*naoxing - setmin);
			
			}
			else{
				setmin = setmin-5*naoxing;
			}
			var stop = document.getElementById("stopBtn");

			
			function toPlay(){
				if (bzy == 1) {
					if(musicb2.play()){musicb2.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb1.play()){musicb1.play();}
				}
				else if (bzy == 2){
					if(musicb1.play()){musicb1.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb2.play()){musicb2.play();}
				}
				else if(bzy == 3){
					if(musicb1.play()){musicb1.pause();}
					if(musicb2.play()){musicb2.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb3.play()){musicb3.play();}
				}
				else if(bzy == 4){
					if(musicb1.play()){musicb1.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb2.play()){musicb2.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb4.play()){musicb4.play();}
				}
				else if(bzy == 5){
					if(musicb1.play()){musicb1.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb2.play()){musicb2.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb5.play()){musicb5.play();}
				}
				else if(bzy == 6){
					if(musicb1.play()){musicb1.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb2.play()){musicb2.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb6.play()){musicb6.play();}
				}
				else if(bzy == 7){
					if(musicb1.play()){musicb1.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb2.play()){musicb2.pause();}
					
					if(!musicb7.play()){musicb7.play();}
				}else{
				musicb1.pause();
				musicb2.pause();
				musicb3.pause();
				musicb4.pause();
				musicb5.pause();
				musicb6.pause();
				musicb7.pause();
		}
			}
			function toStop(){
				musicb1.pause();
				musicb2.pause();
				musicb3.pause();
				musicb4.pause();
				musicb5.pause();
				musicb6.pause();
				musicb7.pause();
			}
			window.onload=function(){
			function showTime(){
				var time=new Date();
				var minute=time.getMinutes();
				var hou=time.getHours();
				var d1=hou>=sethour&&minute>=setmin;
				var d2=hou>=sethour;
				var dt = 1;
				//此处设定dt=1为浅睡
				if((d1||d2)&dt==1){
					if(naozhong==1){
					if(!music1.play()){music1.play();}//响铃
						// alert("成功1");
							//改变字体颜色为红色
							}
					if(naozhong==2){
					if(!music2.play()){music2.play();}//响铃
// 						alert("成功2");
// 							//改变字体颜色为红色
							}
					if(naozhong==3){
					if(!music3.play()){music3.play();}//响铃
// 						alert("成功3");
// 							//改变字体颜色为红色
							}		
					if(naozhong==4){
					if(!music4.play()){music4.play();}//响铃
// 						alert("成功4");
// 							//改变字体颜色为红色
							}	
					if(naozhong==5){
					if(!music5.play()){music5.play();}//响铃
							//改变字体颜色为红色
// 						alert("成功5");
// 						
	}	
					}
				else{music1.pause();
				music2.pause();
				music3.pause();
				music4.pause();
				music5.pause();}//同理
				
			}

			showTime();
			var timer=setInterval(showTime,1000);
			stop.onclick=function(){
			sethour=24;
			}}
			
		</script>
	</body>
<script>
		var dt1=1;
		var dt2=2;
		var dt3=1;
		var dt4=1;
		var dt5=1;
		var dt6=1;
	</script>
<script type="text/javascript">
	function openReport(){
	    mui.openWindow({
		url    : 'sleep_report.html',
		extras :
		{}
	    });
	}
	
	function openNoise(){
	    mui.openWindow({
		url    : 'sleep_noise.html',
		extras :
		{}
	    });
	}

	function openSleep(){
		mui.openWindow({
		url    : 'index.html',
		extras :
		{}
		  });
	}
		
   function recordtime1(){
		var btime = new Date();
		var btime=btime.toLocaleTimeString('chinese', { hour12: false }); 
		//localStorage.setItem(name,value);
		btime=btime.substring(0,5)
		var date = new Date();
        var year = date.getFullYear();
		var month = date.getMonth()+1;
		var day = date.getDate();
		var hour = date.getHours();
		var minute = date.getMinutes();
		var second = date.getSeconds();
		btimes=year+'-'+month+'-'+day+' '+hour+':'+minute+':'+second
        localStorage.setItem("btime",btime);
		localStorage.setItem("btimes",btimes);
	}
	
	function recordtime2(){
		    var etime = new Date();
		    var etime=etime.toLocaleTimeString('chinese', { hour12: false }); 
		    //localStorage.setItem(name,value);
		    etime=etime.substring(0,5)
		    var date = new Date();
		    var year = date.getFullYear();
		    var month = date.getMonth()+1;
		    var day = date.getDate();
		    var hour = date.getHours();
		    var minute = date.getMinutes();
		    var second = date.getSeconds();
		    etimes=year+'-'+month+'-'+day+' '+hour+':'+minute+':'+second
		    localStorage.setItem("etime",etime);
		    localStorage.setItem("etimes",etimes);
	    //     $.ajax({
				 // url:"http://203.195.148.111:8080/index/index/end",
				 // withCredentials:true,
				 // data: {username:un },
				
	        }
	function sleepstate(){
	        $.ajax({url:"http://203.195.148.111:8080/index/index/aiclock",
			data: {dt1:dt1,dt2:dt2,dt3:dt3,dt4:dt4,dt5:dt5,dt6:dt6},
			
			success:function(data) {
				// alert(data);
				}
				})
	         }
	  function newsleeptime(){
		     btime=localStorage.getItem("btime");
			 btimes=localStorage.getItem("btimes");
			 etime=localStorage.getItem("etime");
			 etimes=localStorage.getItem("etimes");
	         $.ajax({url:"http://203.195.148.111:8080/index/index/newbetime",
	 		data: {username:un,btime:btime,btimes:btimes,etime:etime,etimes:etimes},
	 		
	 		success:function(data) {
	 			// alert(data);
	 			}
	 			})
	          }
	
	 function start_score(){
	  dt=setInterval(sleepstate,2000);
	  }
	  
	window.addEventListener('event', function(event){//执行刷新
		var id = event.detail.id;
		alert(id);
		});
	  
	  
</script>

</html>
