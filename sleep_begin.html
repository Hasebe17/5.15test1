<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.css" rel="stylesheet" />
		<script src="js/mui.min.js"></script>
		<link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/sleep/beginsleep.css"/>
		<link rel="stylesheet" type="text/css" href="css/sleep/stylebegin.css">
		<link rel="stylesheet" type="text/css" href="css/sleep/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="css/sleep/default.css">
		<link rel="stylesheet" type="text/css" href="css/common.css"/>
		<link href="https://fonts.googleapis.com/css?family=Nixie+One" rel="stylesheet" type="text/css">
		<style type="text/css">
			body{background: #F0F0F0;}
		</style>
				<script type="text/javascript">  
			 if(window.localStorage){  
			 var un = localStorage.getItem("username");  
			 var pas = localStorage.getItem("password");  
			 //alert(un+pas);  
			 }else{alert("浏览不支持localStorage")}  
		</script>
	<script type="text/javascript">
			if(window.localStorage){
					 	var un = localStorage.getItem("username");
						var pas = localStorage.getItem("password");
						//alert(un+pas);
						var defaT = localStorage.getItem("defatime");
						var naoxing = localStorage.getItem("nx");
						var naozhong = localStorage.getItem("nz");
					    var bzy = localStorage.getItem("bzy");
						
						
					}else{alert("浏览不支持localStorage")};
	</script>
	<script src="svg/iconfont.js" type="text/javascript" charset="utf-8"></script>
		<style>
			.icon {
			width: 35px;
			height: 35px;
			vertical-align: -0.15em;
			fill: currentColor;
			overflow: hidden;
		}
	</style>
	</head>

	<body>
		<script src="js/mui.js"></script>
		<script type="text/javascript">
			mui.init()
		</script>
		<!-- <button type="button" class="noiseBtn" onclick="openNoise()"><h3>白噪音</h3></button> -->
		<div  class="noiseBtn" onclick="openNoise()"> 
			<svg class="icon" aria-hidden="true">
				<use xlink:href="#icon-bzy"></use>
			</svg>
			<h3 class="word1" style="line-height: 0px;">白噪音</h3>
		</div> 
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" ></a>
			<h1 class="mui-title">开始睡眠</h1>
			<audio src='http://hao.haolingsheng.com/ring/000/995/3e3966097062ba7638a0aba60d898b48.mp3' preload='auto' id='music1'>	
			</audio>
			
			<audio src='http://hao.haolingsheng.com/ring/000/995/f1b408f77bc8d27a6f5665c1be02df5d.mp3' preload='auto' id='music2'>	
			</audio>
			
			<audio src='http://hao.haolingsheng.com/ring/000/995/899004608491de178a7234ab5538feb9.mp3' preload='auto' id='music3'>	
			</audio>
			
			<audio src='http://hao.haolingsheng.com/ring/000/995/3428620bff41797ca0fde66a1a47b0fc.mp3' preload='auto' id='music4'>	
			</audio>
			<audio src='http://hao.haolingsheng.com/ring/000/995/bde5a74a2520d82b8ed6d51c227f383c.mp3' preload='auto' id='music5'>	
			</audio>
			
			
			<audio src='http://dl.stream.qqmusic.qq.com/M500001OJfmJ4Yn1pK.mp3?vkey=E1F26808F9D07E7D872095A71278F741F1D6FE50AEBDADC1F1BF6AE5F69A09D0BAF0A6C4A76798AE9F5F107ED23268A5494B98D1B0CC1393&guid=5150825362&fromtag=1' preload='auto' id='musicb1'>	
			</audio>
			
			<audio src='http://dl.stream.qqmusic.qq.com/M500000r0Za842jc98.mp3?vkey=B04EAA6F9433982CDCF074FB2587241F6BECB85A68DC063057A990992CEBD6CAA0F57F884F9CCC1EEE3D6324700CF31387E83BBF0282D28B&guid=5150825362&fromtag=1' preload='auto' id='musicb2'>	
			</audio>
			
			<audio src='http://dl.stream.qqmusic.qq.com/M5000045FTQx2pIwT0.mp3?vkey=0F212497F32AA44B09892567158D3D032BEA125E480A84BC95B097ABF2FF7D1E76613D3B52CC5E2E970707271976FA458028C01432BD541E&guid=5150825362&fromtag=1' preload='auto' id='musicb3'>	
			</audio>
			<audio src='http://dl.stream.qqmusic.qq.com/M5000035Cs5S1CYIrl.mp3?vkey=A36B455F3B69BF0B643D3582CE90FC04E516054124D8A4295CB06E7065116559E3222BD3B54B1F77FB6BD6C55E681A32A4A3F5D2C0F6BF15&guid=5150825362&fromtag=1' preload='auto' id='musicb4'>	
			</audio>
			<audio src='http://dl.stream.qqmusic.qq.com/M500002ia0rv2lI7Wp.mp3?vkey=B7AA8BE7A47887D10776C9D3FF9980A0F3A8B7A4A71E5EC1C648CC0F82F88A12BD15C7A81D56BC6E39C5A1F63DF634AC3126FD20A8A94B8B&guid=5150825362&fromtag=1' preload='auto' id='musicb5'>	
			</audio>
			
			<audio src='http://dl.stream.qqmusic.qq.com/M500000erRwt0fPHdV.mp3?vkey=5CF2F6325FE429F56EEDB485A224C6900267A9AF92F1AF0C3F7AA4B692DB08D152D337B91007FCEAA16E85CF3B3495540B55817EDB500C16&guid=5150825362&fromtag=1' preload='auto' id='musicb6'>	
			</audio>
			<audio src='http://dl.stream.qqmusic.qq.com/M5000015o85F3T8OV1.mp3?vkey=AA5CBB40AE516BA9E68474CD15BA663C5F1A3C8E30EBE94DCED4285568940B02456EAEEBA06CDE565FE6C07B10C5A6786DAC00873942E227&guid=5150825362&fromtag=1' preload='auto' id='musicb7'>	
			</audio>
		</header>
		
		<article class="htmleaf-container">
			<div class="container-fluid">
				<div class="col-xs-12 fill">
					<span id="runner"></span><br><br>
					<div class="col-sm-10 col-sm-offset-2">
						<div class="col-xs-4 col-sm-3 centered" ><button id="stopBtn" onclick="recordtime2();toStop()"></button></div>
						<div class="col-xs-4 col-sm-3 centered"><button id="startBtn" onclick="recordtime1();toPlay();start_score()"></button></div>
						<div class="col-xs-4 col-sm-3 centered"><button id="resetBtn" onclick="toStop()"></button></div>
					</div>
				</div>
			</div>
		</article>
			
		<script src="js/jquery-2.1.1.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.runner-min.js"></script>
		<script src="js/app.js"></script>
		
		<button type="button" class="returnreport" onclick="openReport()">返回报告</button>
		<script>
			 function orientationHandler(event) {
			 alpha = event.alpha;
			 beta = event.beta;
			 gamma = event.gamma;
			}
			
			orientationHandler(event);
			
			function motionHandler(event) {
			document.getElementById("interval").innerHTML = event.interval;
			var acc = event.acceleration;
			var accGravity = event.accelerationIncludingGravity;
			 xg = accGravity.x;
			 yg = accGravity.y;
			 zg = accGravity.z;
				}
			
			motionHandler(event);
				var dt1=alpha;
				var dt2=beta;
				var dt3=gamma;
				var dt4=xg;
				var dt5=yg;
				var dt6=zg;
			</script>
		<script>
			
			var arr = defaT .split(":");
			var sethour = arr[0];
			var setmin = arr[1];
			if(setmin<naoxing*5){
				sethour = sethour-1;
				setmin = 60 - (5*naoxing - setmin);
			
			}
			else{
				setmin = setmin-5*naoxing;
			}
			var stop = document.getElementById("stopBtn");

			
			function toPlay(){

				if (bzy == 1) {
					if(musicb2.play()){musicb2.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb1.play()){musicb1.play();}
				}
				else if (bzy == 2){
					if(musicb1.play()){musicb1.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb2.play()){musicb2.play();}
				}
				else if(bzy == 3){
					if(musicb1.play()){musicb1.pause();}
					if(musicb2.play()){musicb2.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb3.play()){musicb3.play();}
				}
				else if(bzy == 4){
					if(musicb1.play()){musicb1.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb2.play()){musicb2.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb4.play()){musicb4.play();}
				}
				else if(bzy == 5){
					if(musicb1.play()){musicb1.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb2.play()){musicb2.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb5.play()){musicb5.play();}
				}
				else if(bzy == 6){
					if(musicb1.play()){musicb1.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb2.play()){musicb2.pause();}
					if(musicb7.play()){musicb7.pause();}
					
					if(!musicb6.play()){musicb6.play();}
				}
				else if(bzy == 7){
					if(musicb1.play()){musicb1.pause();}
					if(musicb3.play()){musicb3.pause();}
					if(musicb4.play()){musicb4.pause();}
					if(musicb5.play()){musicb5.pause();}
					if(musicb6.play()){musicb6.pause();}
					if(musicb2.play()){musicb2.pause();}
					
					if(!musicb7.play()){musicb7.play();}
				}else{
				musicb1.pause();
				musicb2.pause();
				musicb3.pause();
				musicb4.pause();
				musicb5.pause();
				musicb6.pause();
				musicb7.pause();
		}
			}
			function toStop(){
				musicb1.pause();
				musicb2.pause();
				musicb3.pause();
				musicb4.pause();
				musicb5.pause();
				musicb6.pause();
				musicb7.pause();
			}
			window.onload=function(){
			function showTime(){
				var time=new Date();
				var minute=time.getMinutes();
				var hou=time.getHours();
				var d1=hou>=sethour&&minute>=setmin;
				var d2=hou>=sethour;
				$.ajax({url:"http://203.195.148.111:8080/index/index/aiclock",
				data: {dt1:dt1,dt2:dt2,dt3:dt3,dt4:dt4,dt5:dt5,dt6:dt6},
				success:function(data) {
					var dt=data;
					}
					})
				//此处设定dt=1为浅睡
				if((d1||d2)&dt==1){
					if(naozhong==1){
					if(!music1.play()){music1.play();}//响铃
						// alert("成功1");
							//改变字体颜色为红色
							}
					if(naozhong==2){
					if(!music2.play()){music2.play();}//响铃
// 						alert("成功2");
// 							//改变字体颜色为红色
							}
					if(naozhong==3){
					if(!music3.play()){music3.play();}//响铃
// 						alert("成功3");
// 							//改变字体颜色为红色
							}		
					if(naozhong==4){
					if(!music4.play()){music4.play();}//响铃
// 						alert("成功4");
// 							//改变字体颜色为红色
							}	
					if(naozhong==5){
					if(!music5.play()){music5.play();}//响铃
							//改变字体颜色为红色
// 						alert("成功5");
// 						
	}	
					}
				else{music1.pause();
				music2.pause();
				music3.pause();
				music4.pause();
				music5.pause();}//同理
				
			}

			showTime();
			var timer=setInterval(showTime,1000);
			stop.onclick=function(){
			sethour=24;
			}}
			
		</script>
	</body>

<script type="text/javascript">
	function openReport(){
	    mui.openWindow({
		url    : 'sleep_report.html',
		extras :
		{}
	    });
	}
	
	function openNoise(){
	    mui.openWindow({
		url    : 'sleep_noise.html',
		extras :
		{}
	    });
	}

	function openSleep(){
		mui.openWindow({
		url    : 'index.html',
		extras :
		{}
		  });
	}
		
    function recordtime1(){
		var btime = new Date();
		var btime=btime.toLocaleTimeString('chinese', { hour12: false }); 
		//localStorage.setItem(name,value);
		btime=btime.substring(0,5)
		var date = new Date();
        var year = date.getFullYear();
		var month = date.getMonth()+1;
		var day = date.getDate();
		var hour = date.getHours();
		var minute = date.getMinutes();
		var second = date.getSeconds();
		btimes=year+'-'+month+'-'+day+' '+hour+':'+minute+':'+second
        localStorage.setItem("btime",btime);
		localStorage.setItem("btimes",btimes);
	}
	
	function recordtime2(){
		    var etime = new Date();
		    var etime=etime.toLocaleTimeString('chinese', { hour12: false }); 
		    //localStorage.setItem(name,value);
		    etime=etime.substring(0,5)
		    var date = new Date();
		    var year = date.getFullYear();
		    var month = date.getMonth()+1;
		    var day = date.getDate();
		    var hour = date.getHours();
		    var minute = date.getMinutes();
		    var second = date.getSeconds();
		    etimes=year+'-'+month+'-'+day+' '+hour+':'+minute+':'+second
		    localStorage.setItem("etime",etime);
		    localStorage.setItem("etimes",etimes);
	    //     $.ajax({
				 // url:"http://203.195.148.111:8080/index/index/end",
				 // withCredentials:true,
				 // data: {username:un },
				
	        }
	
	 // function newsleeptime(){
		//      btime=localStorage.getItem("btime");
		// 	 btimes=localStorage.getItem("btimes");
		// 	 etime=localStorage.getItem("etime");
		// 	 etimes=localStorage.getItem("etimes");
	 //         $.ajax({url:"http://203.195.148.111:8080/index/index/newbetime",
	 // 		data: {username:un,btime:btime,btimes:btimes,etime:etime,etimes:etimes},
	 // 		
	 // 		success:function(data) {
	 // 			// alert(data);
	 // 			}
	 // 			})
	 //          }
	
	 function start_score(){
	  dt=setInterval(sleepstate,2000);
	  }
	   
	window.addEventListener('event', function(event){//执行刷新
		var id = event.detail.id;
		alert(id);
		});
	  
</script>

</html>
